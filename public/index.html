<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Simple Vector DB</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<style>
  :root{
    --bg:#0f1724;
    --card:#0b1220;
    --accent:#7c3aed;
    --muted:#94a3b8;
    --surface:#0f1724;
    --glass: rgba(255,255,255,0.03);
  }
  html,body{height:100%}
  body{
    margin:0;
    min-height:100%;
    font-family:Inter,system-ui,Segoe UI,Roboto,Arial;
    background: linear-gradient(180deg, #071028 0%, #071826 50%, #042033 100%);
    color:#e6eef8;
    display:flex;
    align-items:flex-start;
    justify-content:center;
    padding:40px 16px;
  }

  .container{
    width:100%;
    max-width:920px;
  }

  header{
    display:flex;
    align-items:center;
    gap:16px;
    margin-bottom:18px;
  }
  header h1{
    margin:0;
    font-size:20px;
    letter-spacing:-0.02em;
  }
  .card{
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.02));
    border-radius:12px;
    padding:18px;
    box-shadow: 0 6px 24px rgba(3,7,18,0.6);
    backdrop-filter: blur(6px);
  }

  .toolbar{
    display:flex;
    gap:8px;
    flex-wrap:wrap;
    margin-bottom:12px;
  }

  button.btn{
    background:transparent;
    border:1px solid rgba(255,255,255,0.06);
    color:var(--accent);
    padding:8px 12px;
    border-radius:8px;
    cursor:pointer;
    transition: all .14s ease;
    font-weight:600;
  }
  button.btn:hover{ transform:translateY(-2px); box-shadow:0 6px 18px rgba(124,58,237,0.12) }
  button.btn.secondary{
    background:var(--glass);
    color:#dfe9ff;
    border-color: rgba(255,255,255,0.04);
  }

  .form-row{ display:flex; gap:12px; align-items:center; margin-top:8px; flex-wrap:wrap; }
  input[type="text"], input[type="number"], textarea{
    background:transparent;
    border:1px solid rgba(255,255,255,0.06);
    color:#e6eef8;
    padding:10px 12px;
    border-radius:8px;
    min-width:0;
    outline:none;
    width:100%;
  }
  input.small{ width:120px; }
  label{ color:var(--muted); font-size:12px; margin-right:6px; }

  #output, pre#queryOutput{
    white-space:pre-wrap;
    border-radius:8px;
    padding:12px;
    background: rgba(2,6,23,0.6);
    color:#dbeafe;
    margin-top:12px;
    max-height:320px;
    overflow:auto;
    border:1px solid rgba(255,255,255,0.02);
    font-size:13px;
  }

  @media (max-width:600px){
    header h1{ font-size:18px }
    .form-row{ flex-direction:column; align-items:stretch }
    input.small{ width:100% }
  }
</style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Simple Vector DB</h1>
    </header>

    <div class="card">
      <div class="toolbar">
        <button id="btnInsert" class="btn">Insert</button>
        <button id="btnQuery" class="btn">Query</button>
        <button id="btnDelete" class="btn">Delete</button>
      </div>

      <div id="formArea"></div>

      <pre id="output" style="display:none;"></pre>
    </div>
  </div>

<script>
const formArea = document.getElementById("formArea");
const output = document.getElementById("output");
const workerBase = "";

function showOutput(text){
  output.style.display = "block";
  output.textContent = text;
}

function clearForm(){
  formArea.innerHTML = "";
  output.style.display = "none";
  output.textContent = "";
}

document.getElementById("btnInsert").addEventListener("click", () => {
  clearForm();
  formArea.innerHTML = `
    <div class="form-row">
      <input id="insertId" type="text" placeholder="Index / ID">
      <input id="insertText" type="text" placeholder="Text">
      <button id="insertSubmit" class="btn secondary">Insert</button>
    </div>
  `;
  document.getElementById("insertSubmit").addEventListener("click", async () => {
    const id = document.getElementById("insertId").value.trim();
    const text = document.getElementById("insertText").value.trim();
    if(!id || !text){ alert("Both fields are required"); return; }
    try{
      const res = await fetch(workerBase + "/insert", {
        method: "POST",
        body: JSON.stringify({ id, text }),
        headers: { "Content-Type": "application/json" }
      });
      showOutput(await res.text());
    }catch(e){
      showOutput("Insert failed: " + e.message);
    }
  });
});

document.getElementById("btnQuery").addEventListener("click", () => {
  clearForm();
  formArea.innerHTML = `
    <div class="form-row">
      <input id="queryText" type="text" placeholder="Search text">
      <label for="kInput">k</label>
      <input id="kInput" class="small" type="number" min="1" max="100" value="5" />
      <button id="querySubmit" class="btn secondary">Search</button>
    </div>
    <pre id="queryOutput" style="margin-top:8px;">No results yet</pre>
  `;
  const queryInput = document.getElementById("queryText");
  const kInput = document.getElementById("kInput");
  const queryOutput = document.getElementById("queryOutput");
  const submit = document.getElementById("querySubmit");

  async function doSearch(){
    const text = queryInput.value.trim();
    const k = Math.max(1, Math.min(100, Number(kInput.value) || 5));
    if(!text){ alert("Enter search text"); return; }
    queryOutput.textContent = "Searching...";
    try{
      const res = await fetch(workerBase + "/query", {
        method: "POST",
        body: JSON.stringify({ text, k }),
        headers: { "Content-Type": "application/json" }
      });
      const json = await res.json();
      queryOutput.textContent = JSON.stringify(json.results || json, null, 2);
    }catch(e){
      queryOutput.textContent = "Search failed: " + (e.message || e);
    }
  }

  submit.addEventListener("click", doSearch);

  // also allow Enter key to trigger search for convenience
  queryInput.addEventListener("keypress", (e) => {
    if(e.key === "Enter"){
      doSearch();
    }
  });
});

document.getElementById("btnDelete").addEventListener("click", () => {
  clearForm();
  formArea.innerHTML = `
    <div class="form-row">
      <input id="deleteId" type="text" placeholder="Index / ID to delete">
      <button id="deleteSubmit" class="btn secondary">Delete</button>
    </div>
  `;
  document.getElementById("deleteSubmit").addEventListener("click", async () => {
    const id = document.getElementById("deleteId").value.trim();
    if(!id){ alert("Enter ID to delete"); return; }
    try{
      const res = await fetch(workerBase + "/delete", {
        method: "POST",
        body: JSON.stringify({ id }),
        headers: { "Content-Type": "application/json" }
      });
      showOutput(await res.text());
    }catch(e){
      showOutput("Delete failed: " + e.message);
    }
  });
});
</script>
</body>
</html>
